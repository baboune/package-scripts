name:      "ruby"
version:   "1.9.3-p484"
namespace: "/apcera/pkg/runtimes"

sources [
  { url: "https://apcera-sources.s3.amazonaws.com/ruby/ruby-1.9.3-p484.tar.gz",
    sha256: "d684bc3a5ba72cda9ef30039f783c0f8cdc325bae5c8738c7bf05577cbe8f31d" },
  { url: "https://apcera-sources.s3.amazonaws.com/ruby/yaml-0.1.5.tar.gz",
    sha256: "fa87ee8fb7b936ec04457bc044cd561155e1000a4d25029867752e543c2d3bef" },
  { url: "https://s3.amazonaws.com/apcera-sources/ruby/rubygems-2.2.1.tgz",
    sha256: "7f1de72e965583fb41048ae80f7b7c628f51a126a665bbcccf8da99c4784556b" },
  { url: "https://apcera-sources.s3.amazonaws.com/ruby/bundler-1.5.2.gem",
    sha256: "e696038798bbe0a49f73eb08dfc7f57618bcaffc6ca4391d8e6ab28d7720fd41" },
]

build_depends [ { package: "build-essential" } ]
depends       [ { os: "linux" } ]
provides      [ { runtime: "ruby" },
                { runtime: "ruby-1.9" },
                { runtime: "ruby-1.9.3" },
                { runtime: "ruby-1.9.3-p484" } ]

environment { "PATH": "/opt/apcera/ruby-1.9.3-p484/bin:$PATH" }

build (
      export BUILDPATH=`pwd`
      export INSTALLPATH=/opt/apcera/ruby-1.9.3-p484

      tar xzvf yaml-0.1.5.tar.gz
      (
          cd yaml-0.1.5
          ./configure --disable-shared --with-pic
          make
      )

      tar xzvf ruby-1.9.3-p484.tar.gz
      (
        cd ruby-1.9.3-p484
        export LDFLAGS="-L${BUILDPATH}/yaml-0.1.5/src/.libs $LDFLAGS"
        export CPPFLAGS="-I${BUILDPATH}/yaml-0.1.5/include $CPPFLAGS"
        ./configure --prefix=${INSTALLPATH} --enable-shared --disable-install-doc
        make
        sudo make install
      )

      tar zxvf rubygems-2.2.1.tgz
      (
        cd rubygems-2.2.1
        sudo ${INSTALLPATH}/bin/ruby setup.rb
      )

      sudo ${INSTALLPATH}/bin/gem install bundler-1.5.2.gem --no-ri --no-rdoc
)
